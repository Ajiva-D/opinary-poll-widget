(async()=>{let t=await fetch(document.currentScript.dataset.config),e=await t.json();const l=Object.create({create(){const t=document.querySelector(".poll-widget");return t.innerHTML=`<div class="wrapper">\n\t\t<header>${e.question}</header>\n\t\t<div class="poll-area">\n\t\t${(()=>{let t=document.createElement("div");for(let l=0;l<e.options.length;l++)t.innerHTML+=`<input type="checkbox" name="poll" id=${e.options[l].id}/>`;return t.outerHTML||(new XMLSerializer).serializeToString(t)})()}\n\t\t${(()=>{let t=document.createElement("div");for(let l=0;l<e.options.length;l++)t.innerHTML+=`\t<label for=${e.options[l].id} id=${e.options[l].id}>\n\t\t\t<div class="row">\n\t\t\t\t<div class="column">\n\t\t\t\t\t<span class="circle"></span>\n\t\t\t\t\t<span class="text">${e.options[l].option}</span>\n\t\t\t\t</div>\n\t\t\t\t<span class="percent" id="percent_${e.options[l].id}">${e.options[l].percent}%</span>\n\t\t\t</div>\n\t\t\t<div class="progress" id="progress_${e.options[l].id}" style='--w:${e.options[l].percent};'></div>\n\t\t</label>`;return t.outerHTML||(new XMLSerializer).serializeToString(t)})()}\n\t\t</div>\n\t</div>`,t}}),o=t=>{let e=document.querySelectorAll("label");for(let l=0;l<e.length;l++){let o=e[l].getAttribute("id"),n=t.find(t=>t.id==o);console.log(document.querySelector(`#percent_${o}`)),document.querySelector(`#percent_${o}`).innerText=`${n.percent}%`,document.querySelector(`#progress_${o}`).style=`--w:${n.percent}`}},n=l.create(),s=document.querySelectorAll("label");for(let t=0;t<s.length;t++)s[t].addEventListener("click",l=>{let n=l.target.getAttribute("id"),r=JSON.parse(localStorage.getItem(`widgetPollsData_${e.pollID}`));r||(localStorage.setItem(`widgetPollsData_${e.pollID}`,JSON.stringify({})),r={});let i=r.totalVotes?r.totalVotes:0,c=r.pollVotes?r.pollVotes:e.options;i+=1,r.totalVotes=i;for(let t=0;t<c.length;t++)c[t].votes?c[t].votes:c[t].votes=0,n==c[t].id&&(c[t].votes+=1),c[t].percent=c[t].votes/i*100;o(c),r.pollVotes=c,localStorage.setItem(`widgetPollsData_${e.pollID}`,JSON.stringify(r));for(let t=0;t<s.length;t++)s[t].classList.contains("selected")&&s[t].classList.remove("selected");s[t].classList.add("selected");for(let t=0;t<s.length;t++)s[t].classList.add("selectall");let a=s[t].getAttribute("for"),d=document.querySelector("#"+a);"checkbox"==d.getAttribute("type")?d.setAttribute("type","radio"):1==d.checked&&(s[t].classList.remove("selected"),d.setAttribute("type","checkbox"));let p=[];for(let t=0;t<s.length;t++)s[t].classList.contains("selected")&&p.push(t);if(0==p.length)for(let t=0;t<s.length;t++)s[t].removeAttribute("class")});document.getElementById(id).appendChild(n)})();